<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>
	<script src="../../model/users.js" type="text/javascript"></script>
	<script src="../../controllers/usersController.js" type="text/javascript"></script>
	
	<link rel="stylesheet" type="text/css" href="css/users.css">
	
	<script>
		var curSuggestions = [];
		var selectedSug = 0;
		
		function searchUsers() {
			var selUser = document.getElementById("searchText").value
			UsersController.search(selUser, populateSearchResult);
		}
		
		function populateSearchResult(result, error) {
			if (error != null && error != '') {
				document.getElementById("error").innerHTML = error;
				
				document.getElementById("id").innerHTML = '';
				document.getElementById("firstName").innerHTML = '';
			} else {
				document.getElementById("error").innerHTML = '';
				
				document.getElementById("id").innerHTML = result.id;
				document.getElementById("firstName").innerHTML = result.first_name;
			}
		}
		
		function newUserEntered(event) {
			var keyPressedCode;

            if (window.event) { // IE					
            	keyPressedCode = event.keyCode;
            } else if (event.which) { // Netscape/Firefox/Opera					
            	keyPressedCode = event.which;
			} else {
				alert('The suggestions cannot be displayed. Error: The entered key could not be processed');
				return;
			}
			switch(keyPressedCode) {
				case 38: //Arrow up key
				case 40: //Arrow down key
					var totalSug = curSuggestions.length;
					if (totalSug > 0) {
						var oldSelElemId = "sug" + selectedSug;
						document.getElementById(oldSelElemId).className = "";
												
						if (keyPressedCode == 38) {
							selectedSug = (selectedSug == 0) ? totalSug-1 : selectedSug-1;
						} else {
							selectedSug = (selectedSug+1) % totalSug;
						}
						
						var newSelElemId ="sug"+selectedSug;
						document.getElementById(newSelElemId).className = "selected";
						
						document.getElementById("suggestions").style.display = "block";
					}
					break;
				case 13: //Enter key
					if (selectedSug != -1) {
						document.getElementById("searchText").value = curSuggestions[selectedSug];
						document.getElementById("suggestions").style.display = "none";
					}
					break;
				case 27: //Esc key
					hideSuggestions();
					break;
				default:
					//TODO Limitar los escenarios a cuando cambia el texto
					var enteredUser = document.getElementById("searchText").value;
					UsersController.suggest(enteredUser, promptSuggestions);
					break;
			}
		}
		
		function promptSuggestions(suggestions) {
			selectedSug = 0;
			if (suggestions != null) {
				var listSugHTML = '';
				listSugHTML += '<ul id="sugList">';
				for(i=0; i<suggestions.length; i++) {
					listSugHTML += '<li id="sug' + i + '">' + suggestions[i] + '</li>';
				}
				listSugHTML += '</ul>';
				document.getElementById("suggestions").style.display = "block";
				document.getElementById("suggestions").innerHTML = listSugHTML;
				
				curSuggestions = suggestions;
			}
		}
		
		function hideSuggestions() {
			document.getElementById("suggestions").style.display = "none";
		}
		
		function promptSuggestionsIfLoaded() {
			if (curSuggestions != []) {
				document.getElementById("suggestions").style.display = "block";
			}
		}
	</script>
</head>

<body>

<h2>People Profiles</h2>

<table>
<tr>
    <th>
		<input type="text" id="searchText"
			onKeyUp="newUserEntered(event)"
			onFocus="promptSuggestionsIfLoaded()"
			onBlur="hideSuggestions()" >
		<div id="suggestions">
	</th>
    <th><button type="button" onclick="searchUsers()">Search</button></th>
 </tr>

</table>

<table>
	<tr>
	 <th id="error"></th>
	</tr>
	<tr>
	 <th>Id:</th>
	 <th id="id"></th>
	</tr>
	
	<tr>
	 <th>First Name:</th>
	 <th id="firstName"></th>
	</tr>
	
	<tr>
	 <th>Last Name:</th>
	 <th id="lastName"></th>
	</tr>
	
	<tr>
	 <th>User Name:</th>
	 <th id="userName"></th>
	</tr>
	
</table>
<!--{"id":217,"first_name":"Stephanie","last_name":"Webb","username":"swebb0","email":"swebb0@cmu.edu","city":"Awb\u0101r\u012b","country":"Libya","fav_color":"#b7d69f","blog":"http://phoca.cz/vestibulum/sed.png?in=nec&congue=nisi&etiam=volutpat&justo=eleifend&etiam=donec&pretium=ut&iaculis=dolor&justo=morbi&in=vel&hac=lectus&habitasse=in&platea=quam&dictumst=fringilla&etiam=rhoncus&faucibus=mauris&cursus=enim&urna=leo&ut=rhoncus&tellus=sed&nulla=vestibulum&ut=sit&erat=amet&id=cursus&mauris=id&vulputate=turpis&elementum=integer&nullam=aliquet&varius=massa&nulla=id&facilisi=lobortis&cras=convallis&non=tortor&velit=risus&nec=dapibus&nisi=augue&vulputate=vel&nonummy=accumsan&maecenas=tellus&tincidunt=nisi&lacus=eu&at=orci&velit=mauris&vivamus=lacinia&vel=sapien&nulla=quis&eget=libero&eros=nullam&elementum=sit&pellentesque=amet&quisque=turpis&porta=elementum&volutpat=ligula&erat=vehicula&quisque=consequat&erat=morbi&eros=a&viverra=ipsum&eget=integer&congue=a&eget=nibh&semper=in&rutrum=quis&nulla=justo&nunc=maecenas&purus=rhoncus&phasellus=aliquam&in=lacus&felis=morbi&donec=quis","title":"Sr"}-->




</body>
</html>
